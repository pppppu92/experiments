# BPMタップ計算機 - 設計書

## システム構成

### アーキテクチャ
- **フロントエンド**: 単一HTMLファイル
- **構成**: HTML + CSS + JavaScript（Vanilla）
- **データ保存**: ブラウザメモリ上（リロード時リセット）

## データ設計

### 主要データ構造
```javascript
{
  tapTimes: [],        // タップ時刻配列（Date.now()のタイムスタンプ）
  tapCount: 0,         // 現在のタップ回数
  bpm: null,          // 計算されたBPM値
  isCompleted: false  // 11回完了フラグ
}
```

## UI設計

### レイアウト構成
```
┌─────────────────────────────────┐
│            タイトル              │
├─────────────────────────────────┤
│        タップ回数表示            │
│         (X / 11)               │
├─────────────────────────────────┤
│                                 │
│         タップボタン             │
│        (大きなボタン)            │
│                                 │
├─────────────────────────────────┤
│        BPM結果表示              │
│         (BPM: XXX)             │
├─────────────────────────────────┤
│        リセットボタン            │
└─────────────────────────────────┘
```

### スタイル仕様
- **カラーパレット**: 
  - プライマリ: #007bff（青）
  - セカンダリ: #6c757d（グレー）
  - 成功: #28a745（緑）
  - 背景: #f8f9fa（薄いグレー）

- **レスポンシブブレイクポイント**:
  - デスクトップ: 768px以上
  - モバイル: 767px以下

## 機能設計

### 1. タップ計測機能
```javascript
class TapCalculator {
  constructor() {
    this.tapTimes = [];
    this.tapCount = 0;
    this.bpm = null;
    this.isCompleted = false;
  }
  
  handleTap() {
    // タップ時刻記録
    // カウント更新
    // 11回達成時BPM計算
  }
  
  calculateBPM() {
    // 間隔計算（10個の間隔）
    // 平均間隔算出
    // BPM変換（60000ms / 平均間隔ms）
  }
  
  reset() {
    // 全データリセット
  }
}
```

### 2. BPM計算アルゴリズム
```
1. tapTimes配列から連続する2つの要素の差を計算 → 間隔配列
2. 間隔配列の平均値を算出 → 平均間隔（ミリ秒）
3. BPM = 60000 / 平均間隔（ミリ秒）
4. 結果を整数に丸める
```

### 3. UI更新機能
```javascript
class UIController {
  updateTapCount(count) {
    // タップ回数表示更新
  }
  
  updateBPM(bpm) {
    // BPM表示更新
  }
  
  updateButtonState(isCompleted) {
    // ボタン状態変更（完了時は無効化）
  }
  
  showResult(bpm) {
    // 結果表示（アニメーション付き）
  }
}
```

## イベント設計

### イベントフロー
```
1. ページロード → 初期化
2. タップボタンクリック → handleTap()
3. 11回達成 → calculateBPM() → showResult()
4. リセットボタンクリック → reset() → UI初期化
```

### イベントリスナー
- タップボタン: `click`, `touchstart`（モバイル対応）
- リセットボタン: `click`
- ウィンドウ: `resize`（レスポンシブ対応）

## セキュリティ・パフォーマンス設計

### パフォーマンス最適化
- `Date.now()`使用による高精度時刻取得
- DOM操作最小化（必要時のみ更新）
- CSSトランジション活用（JavaScript最小化）

### エラーハンドリング
- 異常なタップ間隔の検出（0ms以下等）
- 計算エラー時のフォールバック表示

## ファイル構成
```
bpm-calculator.html  （全てを含む単一ファイル）
├── HTML構造
├── CSS（<style>タグ内）
└── JavaScript（<script>タグ内）
```